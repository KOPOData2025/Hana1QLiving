<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.example.hana_bank.mapper.LoanProductMapper">
    
    <resultMap id="loanProductResultMap" type="com.example.hana_bank.entity.LoanProduct">
        <id property="productId" column="product_id"/>
        <result property="productName" column="product_name"/>
        <result property="productDescription" column="product_description"/>
        <result property="interestRate" column="interest_rate"/>
        <result property="maxLoanAmount" column="max_loan_amount"/>
        <result property="maxLoanPeriod" column="max_loan_period"/>
        <result property="eligibilityRequirements" column="eligibility_requirements"/>
        <result property="status" column="status"/>
        <result property="createdAt" column="created_at"/>
        <result property="updatedAt" column="updated_at"/>
    </resultMap>
    
    <insert id="insertLoanProduct" parameterType="com.example.hana_bank.entity.LoanProduct">
        <selectKey keyProperty="productId" resultType="long" order="BEFORE">
            SELECT LOAN_PRODUCT_SEQ.NEXTVAL FROM DUAL
        </selectKey>
        INSERT INTO loan_products (
            product_id, product_name, product_description, interest_rate, 
            max_loan_amount, max_loan_period, eligibility_requirements, 
            status, created_at, updated_at
        ) VALUES (
            #{productId}, #{productName}, #{productDescription,jdbcType=VARCHAR}, #{interestRate},
            #{maxLoanAmount}, #{maxLoanPeriod}, #{eligibilityRequirements,jdbcType=VARCHAR},
            #{status}, SYSDATE, SYSDATE
        )
    </insert>
    
    <select id="findById" parameterType="long" resultMap="loanProductResultMap">
        SELECT * FROM loan_products WHERE product_id = #{productId}
    </select>
    
    <select id="findAll" resultMap="loanProductResultMap">
        SELECT * FROM loan_products ORDER BY created_at DESC
    </select>
    
    <select id="findByStatus" parameterType="string" resultMap="loanProductResultMap">
        SELECT * FROM loan_products WHERE status = #{status} ORDER BY created_at DESC
    </select>
    
    <update id="updateLoanProduct" parameterType="com.example.hana_bank.entity.LoanProduct">
        UPDATE loan_products SET
            product_name = #{productName},
            product_description = #{productDescription},
            interest_rate = #{interestRate},
            max_loan_amount = #{maxLoanAmount},
            max_loan_period = #{maxLoanPeriod},
            eligibility_requirements = #{eligibilityRequirements},
            status = #{status},
            updated_at = SYSDATE
        WHERE product_id = #{productId}
    </update>
    
    <delete id="deleteLoanProduct" parameterType="long">
        DELETE FROM loan_products WHERE product_id = #{productId}
    </delete>
    
</mapper>
